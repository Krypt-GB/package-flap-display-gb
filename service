#!/usr/bin/python

import time
import urllib2 
import textwrap # New import for word wrapping
from ibquery import InfoBeamerQuery

# ... [Keep your ICAL_URL and get_todays_meal() the same] ...

def main():
    # Configuration for your specific display
    WIDTH = 25 
    
    while 1:
        ib = InfoBeamerQuery("127.0.0.1")
        
        # 1. Get data
        meal = get_todays_meal()
        today_date = time.strftime("%A %d-%m-%Y")

        # 2. Wrap the meal text
        # 'subsequent_indent' ensures that wrapped lines align with the first line
        wrapped_meal = textwrap.fill(meal.upper(), width=WIDTH)

        # 3. Write to display
        # We start with a newline (\n) to move the date to Row 2
        # Then two newlines (\n\n) to leave a gap before the meal
        con = ib.node("display/atomic").io(raw=True)
        con.write("\n%s\n\n%s\n" % (today_date, wrapped_meal))
        con.close()

        time.sleep(10)

if __name__ == "__main__":
    main()
